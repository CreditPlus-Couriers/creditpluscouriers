<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Track your shipment with Credit Plus Couriers. Secure, real-time delivery updates.">
  <title>Credit Plus Couriers</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <!-- Leaflet Map CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #fffefc, #ffe4c4);
    }
    .step.active { background-color: #ed8936; color: white; }
    .step.completed::before { content: '‚úî '; color: green; }
    .animate-glow {
      animation: glow 2s infinite ease-in-out;
    }
    @keyframes glow {
      0% { box-shadow: 0 0 5px #ffa94d; }
      50% { box-shadow: 0 0 20px #ff7300; }
      100% { box-shadow: 0 0 5px #ffa94d; }
    }
  </style>
</head>
<body class="bg-orange-50 text-sm">

<!-- Header -->
<header class="bg-orange-600 text-white p-4 shadow">
  <div class="max-w-6xl mx-auto flex items-center justify-between">
    <div class="flex items-center gap-4">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRAIEEyDEBQRd8sgKRwLDTi02YHzmE2tgiBIA&s" alt="Logo" class="h-10 object-contain max-w-[140px]">
      <h1 class="text-sm font-bold">Credit Plus Couriers</h1>
    </div>
    <a href="#tracking" class="bg-white text-orange-600 px-4 py-2 rounded font-semibold hover:bg-orange-100">Track</a>
  </div>
</header>

<!-- Hero -->
<section class="text-center py-12 px-4 bg-gradient-to-r from-orange-100 to-white">
  <h2 class="text-lg font-semibold text-orange-600 mb-2">Fast, Safe & Reliable Deliveries</h2>
  <p class="text-xs mb-6">Track your shipment easily using your AWB number.</p>
  <a href="#tracking" class="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600">Track Package</a>
</section>

<!-- Alert -->
<div id="tracking" class="bg-red-600 text-white p-2 text-center font-semibold">
  ‚ö†Ô∏è Never share your OTP or personal delivery info with others.
</div>

<!-- Tracking Form -->
<section class="max-w-xl mx-auto mt-6 p-4 bg-white shadow rounded">
  <h2 class="text-base font-bold text-orange-600 mb-3">Track Your Shipment</h2>
  <input id="trackingInput" type="text" placeholder="Enter AWB Number" class="w-full border p-3 rounded mb-4 focus:ring-orange-500" />
  <button onclick="trackShipment()" class="w-full bg-orange-500 text-white py-2 rounded hover:bg-orange-600">Track</button>

  <!-- Result Box -->
  <div id="trackingResult" class="hidden mt-6 space-y-4">
    <div class="space-y-1">
      <img id="awbImage" src="" class="mb-4 rounded shadow-md w-full max-w-xs mx-auto hidden" />
      <p><strong>AWB Number:</strong> <span id="awb"></span></p>
      <p><strong>Customer:</strong> <span id="customer"></span></p>
      <p><strong>Origin:</strong> <span id="origin"></span></p>
      <p><strong>Destination:</strong> <span id="destination"></span></p>
      <p><strong>Last Updated:</strong> <span id="lastUpdate"></span></p>
      <p><strong>Expected Delivery:</strong> <span id="expectedDelivery"></span></p>
      <p class="text-orange-600 font-semibold">üì¶ Arriving On 6 August By 12 PM</p>
    </div>

    <div id="deliveryNotice" class="bg-orange-500 text-white p-3 rounded text-center animate-glow hidden">
      üöö Delivery Partner Assigned: +91 22 6809 1958 (Share OTP 56292)
    </div>

    <!-- Map Box -->
    <div id="map" class="w-full h-64 rounded shadow hidden"></div>
<!-- Timeline -->
    <h4 class="font-semibold text-orange-600">Shipment Timeline</h4>
    <div class="flex flex-col gap-2">
      <div id="step1" class="step p-2 rounded">Order Received</div>
      <div id="step2" class="step p-2 rounded">Dispatched</div>
      <div id="step3" class="step p-2 rounded">In Transit</div>
      <div id="step4" class="step p-2 rounded">Out for Delivery</div>
      <div id="step5" class="step p-2 rounded">Delivered</div>
    </div>

    <!-- History -->
    <h4 class="font-semibold text-orange-600 mt-4">Shipment History</h4>
    <ul class="list-disc list-inside text-xs text-gray-700 space-y-1">
      <li id="history1"></li>
      <li id="history2"></li>
      <li id="history3"></li>
    </ul>
  </div>

  <!-- Error Box -->
  <div id="error" class="mt-4 text-red-600 hidden">Tracking ID not found. Please check and try again.</div>
</section>

<!-- Leaflet Map JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBetwZ02ZccH8kfVPx7idT4kvwefwlDCGk",
    authDomain: "creditplustracking.firebaseapp.com",
    databaseURL: "https://creditplustracking-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "creditplustracking",
    storageBucket: "creditplustracking.appspot.com",
    messagingSenderId: "751793033151",
    appId: "1:751793033151:web:72e0535b4880bfd5ee5b0a",
    measurementId: "G-3XWB0DWZNT"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  window.trackShipment = function () {
    const input = document.getElementById("trackingInput").value.trim().toUpperCase();
    const resultBox = document.getElementById("trackingResult");
    const errorBox = document.getElementById("error");
    const awbImg = document.getElementById("awbImage");
    const mapBox = document.getElementById("map");
    const deliveryNotice = document.getElementById("deliveryNotice");

    resultBox.classList.add("hidden");
    errorBox.classList.add("hidden");
    awbImg.classList.add("hidden");
    deliveryNotice.classList.add("hidden");
    mapBox.classList.add("hidden");

    get(child(ref(db), `shipments/${input}`)).then(snapshot => {
      if (!snapshot.exists()) {
        errorBox.classList.remove("hidden");
        return;
      }

      const data = snapshot.val();

      document.getElementById("awb").innerText = input;
      document.getElementById("customer").innerText = data.customer;
      document.getElementById("origin").innerText = data.origin;
      document.getElementById("destination").innerText = data.destination;
      document.getElementById("lastUpdate").innerText = data.lastUpdate;
      document.getElementById("expectedDelivery").innerText = data.expectedDelivery;

      if (input === "AWB56300") {
        awbImg.src = "https://raw.githubusercontent.com/CreditPlus-Couriers/creditpluscouriers/main/awb56300.jpg";
        awbImg.classList.remove("hidden");
      } else if (input === "AWB56200") {
        awbImg.src = "https://raw.githubusercontent.com/CreditPlus-Couriers/creditpluscouriers/main/awb56200.jpg";
        awbImg.classList.remove("hidden");
      }

      resetSteps();
      highlightSteps(data.status);

      document.getElementById("history1").innerText = data.history[0] || "";
      document.getElementById("history2").innerText = data.history[1] || "";
      document.getElementById("history3").innerText = data.history[2] || "";

      if (["In Transit", "Out for Delivery"].includes(data.status)) {
        deliveryNotice.classList.remove("hidden");
      }

      mapBox.classList.remove("hidden");
      showLiveMap(input, data);

      resultBox.classList.remove("hidden");
    }).catch(err => {
      errorBox.innerText = "Error fetching tracking data.";
      errorBox.classList.remove("hidden");
    });

    function resetSteps() {
      for (let i = 1; i <= 5; i++) {
        const s = document.getElementById("step" + i);
        s.className = "step p-2 rounded";
      }
    }

    function highlightSteps(status) {
      const map = {
        "Order Received": 1,
        "Dispatched": 2,
        "In Transit": 3,
        "Out for Delivery": 4,
        "Delivered": 5
      };
      const curr = map[status] || 1;
      for (let i = 1; i <= curr; i++) {
        const s = document.getElementById("step" + i);
        s.classList.add(i === curr ? "active" : "completed");
      }
    }
  }
</script>
<!-- Animated Rider Logic -->
<script>
  let mapInstance = null;
  let riderMarker = null;
  let facilityMarker = null;
  let destinationMarker = null;

  function showLiveMap(awb, data) {
    const facilityCoords = [18.5204, 73.8567]; // Our Facility (Pune)
    const destinationCoords = [data.lat, data.lng];
    const riderCoords = data.rider;

    if (mapInstance) {
      mapInstance.remove();
      mapInstance = null;
    }

    mapInstance = L.map("map").setView(facilityCoords, 9);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(mapInstance);

    // Our Facility Marker
    facilityMarker = L.marker(facilityCoords)
      .addTo(mapInstance)
      .bindPopup("Our Facility")
      .openPopup();

    // Destination Marker
    destinationMarker = L.marker(destinationCoords)
      .addTo(mapInstance)
      .bindPopup(data.customer + "'s Location");

    // Custom Scooter Icon
    const scooterIcon = L.icon({
      iconUrl: "https://cdn-icons-png.flaticon.com/512/888/888857.png",
      iconSize: [40, 40],
      iconAnchor: [20, 20],
      popupAnchor: [0, -20],
    });

    // Rider Marker with Scooter Icon (starts from facility)
    riderMarker = L.marker(facilityCoords, { icon: scooterIcon }).addTo(mapInstance);

    // Animate Rider from Facility to Destination
    animateRider(facilityCoords[0], facilityCoords[1], destinationCoords[0], destinationCoords[1]);
  }

  function animateRider(startLat, startLng, endLat, endLng) {
    let lat = startLat;
    let lng = startLng;
    const steps = 200;
    let i = 0;

    const latStep = (endLat - startLat) / steps;
    const lngStep = (endLng - startLng) / steps;

    function moveStep() {
      if (i >= steps) return;
      lat += latStep;
      lng += lngStep;
      riderMarker.setLatLng([lat, lng]);
      i++;
      requestAnimationFrame(moveStep);
    }

    moveStep();
  }
</script>
<script type="module">
// Firebase Config
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// Firebase Setup
const firebaseConfig = {
  apiKey: "AIzaSyBetwZ02ZccH8kfVPx7idT4kvwefwlDCGk",
  authDomain: "creditplustracking.firebaseapp.com",
  databaseURL: "https://creditplustracking-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "creditplustracking",
  storageBucket: "creditplustracking.appspot.com",
  messagingSenderId: "751793033151",
  appId: "1:751793033151:web:72e0535b4880bfd5ee5b0a",
  measurementId: "G-3XWB0DWZNT"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.trackShipment = function () {
  const input = document.getElementById("trackingInput").value.trim().toUpperCase();
  const resultBox = document.getElementById("trackingResult");
  const errorBox = document.getElementById("error");
  const awbImg = document.getElementById("awbImage");
  const mapBox = document.getElementById("map");
  const deliveryNotice = document.getElementById("deliveryNotice");

  resultBox.classList.add("hidden");
  errorBox.classList.add("hidden");
  awbImg.classList.add("hidden");
  deliveryNotice.classList.add("hidden");
  mapBox.classList.add("hidden");

  get(child(ref(db), `shipments/${input}`)).then(snapshot => {
    if (!snapshot.exists()) {
      errorBox.classList.remove("hidden");
      return;
    }

    const data = snapshot.val();

    // Populate shipment info
    document.getElementById("awb").innerText = input;
    document.getElementById("customer").innerText = data.customer;
    document.getElementById("origin").innerText = data.origin;
    document.getElementById("destination").innerText = data.destination;
    document.getElementById("lastUpdate").innerText = data.lastUpdate;
    document.getElementById("expectedDelivery").innerText = data.expectedDelivery;

    // Show image
    if (input === "AWB56300") {
      awbImg.src = "https://raw.githubusercontent.com/CreditPlus-Couriers/creditpluscouriers/main/awb56300.jpg";
      awbImg.classList.remove("hidden");
    } else if (input === "AWB56200") {
      awbImg.src = "https://raw.githubusercontent.com/CreditPlus-Couriers/creditpluscouriers/main/awb56200.jpg";
      awbImg.classList.remove("hidden");
    }

    // Timeline and history
    resetSteps();
    highlightSteps(data.status);
    document.getElementById("history1").innerText = data.history[0] || "";
    document.getElementById("history2").innerText = data.history[1] || "";
    document.getElementById("history3").innerText = data.history[2] || "";

    // Delivery note
    if (["In Transit", "Out for Delivery"].includes(data.status)) {
      deliveryNotice.classList.remove("hidden");
    }

    // Map + Rider
    mapBox.classList.remove("hidden");
    showLiveMap(input, data);

    resultBox.classList.remove("hidden");
  }).catch(err => {
    errorBox.innerText = "Error fetching tracking data.";
    errorBox.classList.remove("hidden");
  });

  function resetSteps() {
    for (let i = 1; i <= 5; i++) {
      const s = document.getElementById("step" + i);
      s.className = "step p-2 rounded";
    }
  }

  function highlightSteps(status) {
    const map = {
      "Order Received": 1,
      "Dispatched": 2,
      "In Transit": 3,
      "Out for Delivery": 4,
      "Delivered": 5
    };
    const curr = map[status] || 1;
    for (let i = 1; i <= curr; i++) {
      const s = document.getElementById("step" + i);
      s.classList.add(i === curr ? "active" : "completed");
    }
  }
}
</script>
<script>
  let mapInstance = null;
  let riderMarker = null;
  let facilityMarker = null;
  let destinationMarker = null;

  function showLiveMap(awb, data) {
    const facilityCoords = [18.5204, 73.8567]; // Our Facility (Pune)
    const destinationCoords = [data.lat, data.lng];
    const riderCoords = data.rider;

    // Destroy old map
    if (mapInstance) {
      mapInstance.remove();
      mapInstance = null;
    }

    mapInstance = L.map("map").setView(facilityCoords, 10);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(mapInstance);

    // Facility marker
    facilityMarker = L.marker(facilityCoords)
      .addTo(mapInstance)
      .bindPopup("Our Facility")
      .openPopup();

    // Destination marker
    destinationMarker = L.marker(destinationCoords)
      .addTo(mapInstance)
      .bindPopup(data.customer + "'s Location");

    // Custom scooter icon
    const scooterIcon = L.icon({
      iconUrl: "https://cdn-icons-png.flaticon.com/512/2972/2972185.png", // Scooter icon with rider
      iconSize: [48, 48],
      iconAnchor: [24, 24],
      popupAnchor: [0, -20],
    });

    // Rider marker
    riderMarker = L.marker([facilityCoords[0], facilityCoords[1]], { icon: scooterIcon })
      .addTo(mapInstance)
      .bindPopup("Delivery Partner");

    // Animate rider from facility to destination
    animateRider(facilityCoords, destinationCoords);
  }

  function animateRider(start, end) {
    let lat = start[0];
    let lng = start[1];
    const steps = 100;
    let i = 0;
    const latStep = (end[0] - start[0]) / steps;
    const lngStep = (end[1] - start[1]) / steps;

    function moveStep() {
      if (i >= steps) return;
      lat += latStep;
      lng += lngStep;
      riderMarker.setLatLng([lat, lng]);
      i++;
      requestAnimationFrame(moveStep);
    }

    moveStep();
  }
</script>
