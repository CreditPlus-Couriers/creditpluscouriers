<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Credit Plus Couriers</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet Map CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #fffefc, #ffe4c4);
    }
    .step.active { background-color: #ed8936; color: white; }
    .step.completed::before { content: '‚úî '; color: green; }
    .animate-glow {
      animation: glow 2s infinite ease-in-out;
    }
    @keyframes glow {
      0% { box-shadow: 0 0 5px #ffa94d; }
      50% { box-shadow: 0 0 20px #ff7300; }
      100% { box-shadow: 0 0 5px #ffa94d; }
    }
  </style>
</head>
<body class="bg-orange-50 text-sm">

  <!-- Header -->
  <header class="bg-orange-600 text-white p-4 shadow">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRAIEEyDEBQRd8sgKRwLDTi02YHzmE2tgiBIA&s" alt="Logo" class="h-10 object-contain max-w-[140px]">
        <h1 class="text-sm font-bold">Credit Plus Couriers</h1>
      </div>
      <a href="#tracking" class="bg-white text-orange-600 px-4 py-2 rounded font-semibold hover:bg-orange-100">Track</a>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="text-center py-12 px-4 bg-gradient-to-r from-orange-100 to-white">
    <h2 class="text-lg font-semibold text-orange-600 mb-2">Fast, Safe & Reliable Deliveries</h2>
    <p class="text-xs mb-6">Track your shipment easily using your AWB number.</p>
    <a href="#tracking" class="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600">Track Package</a>
  </section>

  <!-- Alert -->
  <div id="tracking" class="bg-red-600 text-white p-2 text-center font-semibold">‚ö†Ô∏è Never share your OTP or personal delivery info with others.</div>

  <!-- Tracking Form -->
  <section class="max-w-xl mx-auto mt-6 p-4 bg-white shadow rounded">
    <h2 class="text-base font-bold text-orange-600 mb-3">Track Your Shipment</h2>
    <input id="trackingInput" type="text" placeholder="Enter AWB Number" class="w-full border p-3 rounded mb-4 focus:ring-orange-500" />
    <button onclick="trackShipment()" class="w-full bg-orange-500 text-white py-2 rounded hover:bg-orange-600">Track</button>

    <!-- Tracking Result (hidden by default) -->
    <div id="trackingResult" class="hidden mt-6 space-y-4">
      <img id="awbImage" src="" class="mb-4 rounded shadow-md w-full max-w-xs mx-auto hidden" />
      <p><strong>AWB Number:</strong> <span id="awb"></span></p>
      <p><strong>Customer:</strong> <span id="customer"></span></p>
      <p><strong>Origin:</strong> <span id="origin"></span></p>
      <p><strong>Destination:</strong> <span id="destination"></span></p>
      <p><strong>Last Updated:</strong> <span id="lastUpdate"></span></p>
      <p><strong>Expected Delivery:</strong> <span id="expectedDelivery"></span></p>
      <p class="text-orange-600 font-semibold">üì¶ Arriving On 6 August By 12 PM</p>

      <div id="deliveryNotice" class="bg-orange-500 text-white p-3 rounded text-center animate-glow hidden">
        üöö Delivery Partner Assigned: +91 22 6809 1958 (Share OTP 56292)
      </div>

      <!-- Map Container -->
      <div id="map" class="w-full h-64 rounded shadow hidden"></div>

      <!-- Shipment Timeline -->
      <h4 class="font-semibold text-orange-600">Shipment Timeline</h4>
      <div class="flex flex-col gap-2">
        <div id="step1" class="step p-2 rounded">Order Received</div>
        <div id="step2" class="step p-2 rounded">Dispatched</div>
        <div id="step3" class="step p-2 rounded">In Transit</div>
        <div id="step4" class="step p-2 rounded">Out for Delivery</div>
        <div id="step5" class="step p-2 rounded">Delivered</div>
      </div>

      <!-- Shipment History -->
      <h4 class="font-semibold text-orange-600 mt-4">Shipment History</h4>
      <ul class="list-disc list-inside text-xs text-gray-700 space-y-1">
        <li id="history1"></li>
        <li id="history2"></li>
        <li id="history3"></li>
      </ul>
    </div>

    <!-- Error Message -->
    <div id="error" class="mt-4 text-red-600 hidden">Tracking ID not found. Please check and try again.</div>
  </section>
<!-- Firebase & Leaflet JS -->
<script type="module">
  // Import Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, get, child, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBetwZ02ZccH8kfVPx7idT4kvwefwlDCGk",
    authDomain: "creditplustracking.firebaseapp.com",
    databaseURL: "https://creditplustracking-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "creditplustracking",
    storageBucket: "creditplustracking.appspot.com",
    messagingSenderId: "751793033151",
    appId: "1:751793033151:web:72e0535b4880bfd5ee5b0a"
  };

  // Init Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Global rider marker
  let riderMarker;

  // Track button logic
  window.trackShipment = function () {
    const input = document.getElementById("trackingInput").value.trim().toUpperCase();
    const resultBox = document.getElementById("trackingResult");
    const errorBox = document.getElementById("error");
    const awbImg = document.getElementById("awbImage");
    const mapBox = document.getElementById("map");
    const deliveryNotice = document.getElementById("deliveryNotice");

    resultBox.classList.add("hidden");
    errorBox.classList.add("hidden");
    awbImg.classList.add("hidden");
    deliveryNotice.classList.add("hidden");
    mapBox.classList.add("hidden");

    get(child(ref(db), `shipments/${input}`)).then(snapshot => {
      if (!snapshot.exists()) {
        errorBox.classList.remove("hidden");
        return;
      }

      const data = snapshot.val();

      document.getElementById("awb").innerText = input;
      document.getElementById("customer").innerText = data.customer;
      document.getElementById("origin").innerText = data.origin;
      document.getElementById("destination").innerText = data.destination;
      document.getElementById("lastUpdate").innerText = data.lastUpdate;
      document.getElementById("expectedDelivery").innerText = data.expectedDelivery;

      if (input === "AWB56300") {
        awbImg.src = "https://raw.githubusercontent.com/CreditPlus-Couriers/creditpluscouriers/main/awb56300.jpg";
        awbImg.classList.remove("hidden");
      } else if (input === "AWB56200") {
        awbImg.src = "https://raw.githubusercontent.com/CreditPlus-Couriers/creditpluscouriers/main/awb56200.jpg";
        awbImg.classList.remove("hidden");
      }

      // Timeline
      resetSteps();
      highlightSteps(data.status);

      // History
      document.getElementById("history1").innerText = data.history[0] || "";
      document.getElementById("history2").innerText = data.history[1] || "";
      document.getElementById("history3").innerText = data.history[2] || "";

      // Show delivery partner note
      if (["In Transit", "Out for Delivery"].includes(data.status)) {
        deliveryNotice.classList.remove("hidden");
      }

      // Map logic
      mapBox.classList.remove("hidden");
      renderMap(data, input);

      // Reveal result box
      resultBox.classList.remove("hidden");
    }).catch(err => {
      errorBox.innerText = "Error fetching tracking data.";
      errorBox.classList.remove("hidden");
    });

    function resetSteps() {
      for (let i = 1; i <= 5; i++) {
        const s = document.getElementById("step" + i);
        s.className = "step p-2 rounded";
      }
    }

    function highlightSteps(status) {
      const map = {
        "Order Received": 1,
        "Dispatched": 2,
        "In Transit": 3,
        "Out for Delivery": 4,
        "Delivered": 5
      };
      const curr = map[status] || 1;
      for (let i = 1; i <= curr; i++) {
        const s = document.getElementById("step" + i);
        s.classList.add(i === curr ? "active" : "completed");
      }
    }

    // MAP setup with Leaflet
    function renderMap(data, awb) {
      const destination = [data.lat, data.lng];
      const source = [18.5204, 73.8567]; // Pune facility

      const map = L.map("map").setView(destination, 11);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors"
      }).addTo(map);

      L.marker(source).addTo(map).bindPopup("Our Facility").openPopup();
      L.marker(destination).addTo(map).bindPopup("Destination");

      // Rider marker with icon
      const riderIcon = L.icon({
        iconUrl: "https://cdn-icons-png.flaticon.com/512/685/685352.png",
        iconSize: [32, 32],
        iconAnchor: [16, 16]
      });

      riderMarker = L.marker([data.rider.lat, data.rider.lng], { icon: riderIcon }).addTo(map).bindPopup("Rider");

      // Live update rider
      const riderRef = ref(db, `shipments/${awb}/rider`);
      onValue(riderRef, snap => {
        const rider = snap.val();
        if (rider && riderMarker) {
          riderMarker.setLatLng([rider.lat, rider.lng]);
        }
      });
    }
  };
</script>
<!-- Scroll to Top Button -->
<button onclick="window.scrollTo({ top: 0, behavior: 'smooth' });"
  class="fixed bottom-6 right-6 bg-orange-500 text-white p-3 rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 z-50">
  ‚Üë
</button>

<!-- Floating Help Assistant -->
<div class="fixed bottom-16 right-6 z-50">
  <button class="bg-orange-600 text-white px-4 py-2 rounded-full shadow-lg text-sm hover:bg-orange-700 transition-all">
    üí¨ Need Help?
  </button>
</div>

<!-- Footer Bar -->
<footer class="bg-orange-600 text-white text-center py-3 text-xs mt-6">
  Privacy Policy | Terms & Conditions | Contact | Support | Courier Details
</footer>

<!-- Extended Footer -->
<footer class="bg-white border-t border-orange-200 pt-6 pb-10 px-4 text-center text-sm text-gray-600">
  <div class="flex flex-col sm:flex-row justify-center items-center gap-6">
    <div>
      <p><strong>Contact Us:</strong> support@creditpluscouriers.com</p>
      <p>üìç Pune HQ</p>
    </div>
    <div>
      <p><strong>Quick Links</strong></p>
      <p>Privacy Policy | Terms & Conditions | Support</p>
    </div>
    <div class="flex gap-4 mt-2">
      <img src="https://img.icons8.com/fluency/24/facebook-new.png" alt="Facebook"/>
      <img src="https://img.icons8.com/fluency/24/twitter.png" alt="Twitter"/>
      <img src="https://img.icons8.com/fluency/24/instagram-new.png" alt="Instagram"/>
    </div>
  </div>
</footer>

<!-- Testimonials Section -->
<section class="bg-orange-50 py-12 mt-12">
  <div class="max-w-5xl mx-auto px-4">
    <h2 class="text-2xl font-bold text-center text-orange-700 mb-8">Customer Testimonials</h2>
    <div class="grid md:grid-cols-3 gap-6">
      <div class="bg-white p-6 rounded-xl shadow-md">
        <p class="text-gray-700 italic">"Smooth delivery process and great updates!"</p>
        <p class="mt-2 text-sm font-semibold text-orange-600">‚Äì Rajiv D.</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-md">
        <p class="text-gray-700 italic">"Arrived on time, very happy with the tracking."</p>
        <p class="mt-2 text-sm font-semibold text-orange-600">‚Äì Neha S.</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-md">
        <p class="text-gray-700 italic">"Support helped me reroute smoothly."</p>
        <p class="mt-2 text-sm font-semibold text-orange-600">‚Äì Karan P.</p>
      </div>
    </div>
  </div>
</section>
<!-- Raise a Request Form -->
<section class="py-12 bg-white border-t border-gray-200 mt-8">
  <div class="max-w-3xl mx-auto px-4">
    <h2 class="text-2xl font-bold text-center text-orange-700 mb-6">Raise a Request</h2>
    <form class="space-y-4">
      <input type="text" placeholder="Your Name"
        class="w-full border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-orange-400" required />
      <input type="email" placeholder="Your Email"
        class="w-full border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-orange-400" required />
      <input type="text" placeholder="AWB Number (if any)" class="w-full border rounded-md p-2" />
      <textarea placeholder="Describe your issue or request..." rows="4"
        class="w-full border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-orange-400"></textarea>
      <button type="submit"
        class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-md">Submit</button>
    </form>
  </div>
</section>

<!-- Leaflet Map CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- Firebase Live Rider Map Script -->
<script>
  function showMap(awb) {
    let destinationCoords = [];
    let destinationLabel = "";
    let mapCenter = [18.5204, 73.8567]; // Default: Pune

    if (awb === "AWB56200") {
      destinationCoords = [19.272617, 72.961120]; // Sujata's Home (Thane)
      destinationLabel = "Sujata's Home (Thane)";
      mapCenter = destinationCoords;
    } else if (awb === "AWB56300") {
      destinationCoords = [18.9804, 73.0387]; // Mandar's Home (Ulwe)
      destinationLabel = "Mandar's Home (Ulwe)";
      mapCenter = destinationCoords;
    }

    const map = L.map("map").setView(mapCenter, 11);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    L.marker([18.5204, 73.8567])
      .addTo(map)
      .bindPopup("Our Facility (Pune)")
      .openPopup();

    L.marker(destinationCoords)
      .addTo(map)
      .bindPopup(destinationLabel);

    // Rider marker logic (real-time from Firebase)
    const riderIcon = L.icon({
      iconUrl: "https://cdn-icons-png.flaticon.com/128/7870/7870991.png",
      iconSize: [40, 40],
      iconAnchor: [20, 40],
      popupAnchor: [0, -40]
    });

    const riderMarker = L.marker([0, 0], { icon: riderIcon }).addTo(map);

    const riderRef = firebase.database().ref(`shipments/${awb}/rider`);
    riderRef.on("value", (snapshot) => {
      const rider = snapshot.val();
      if (rider && rider.lat && rider.lng) {
        riderMarker.setLatLng([rider.lat, rider.lng]);
        riderMarker.bindPopup("Delivery Partner (Live)").openPopup();
      }
    });
  }
</script>

<!-- Scroll to Top Button -->
<button onclick="window.scrollTo({ top: 0, behavior: 'smooth' });"
  class="fixed bottom-6 right-6 bg-orange-500 text-white p-3 rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 z-50">
  ‚Üë
</button>

<!-- Floating Help Assistant -->
<div class="fixed bottom-16 right-6 z-50">
  <button class="bg-orange-600 text-white px-4 py-2 rounded-full shadow-lg text-sm hover:bg-orange-700 transition-all">
    üí¨ Need Help?
  </button>
</div>

<!-- Footer -->
<footer class="bg-orange-600 text-white text-center py-3 text-xs mt-6">
  Privacy Policy | Terms & Conditions | Contact | Support | Courier Details
</footer>

</body>
</html>
